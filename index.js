const e=Object.freeze({domain:23,organization:39,repository:100}),t=t=>{const a=String(t).trim(),r=a.length,o=e.domain+e.organization+e.repository;if(r>o)throw new Error(`O tamanho máximo da URL foi excedido (${r}/${o}).`);const s=a.match(/^https?:\/\/github\.com\/([^\/]+)\/([^\/]+)(?:\/|$)/);if(!s||!s[1]||!s[2])throw new Error("A URL do repositório é inválida.");const i={organization:s[1],repository:s[2]};if(i.organization.length>e.organization)throw new Error(`O nome da organização excedeu o tamanho de caracteres (${i.organization.length}/${e.organization}).`,{cause:400});if(i.repository.length>e.repository)throw new Error(`O nome do repositório excedeu o tamanho de caracteres (${i.repository.length}/${e.repository}).`,{cause:400});if(-1!==i.repository.indexOf("/")||-1!==i.repository.indexOf("#")||-1!==i.repository.indexOf("?"))throw new Error("Verifique a URL do repositório.",{cause:400});return i},a=Object.freeze({STAR_POINTS:1,FORK_POINTS:2,DIRECT_REPOSITORY_DEPENDENTS_POINTS:4,DIRECT_REPOSITORY_DEPENDENTS_INTERVAL:10,TOTAL_DOWNLOADS_POINTS:2,TOTAL_DOWNLOADS_INTERVAL:2e3,MONTHLY_DOWNLOADS_POINTS:3,MONTHLY_DOWNLOADS_INTERVAL:1e3,CONTRIBUTOR_POINTS:5,CLOSED_ISSUE_POINTS:2,ISSUE_PENALTY:1,MIN_INACTIVE_YEARS_FOR_PENALTY:2,INACTIVE_ISSUE_PENALTY:2e3,INACTIVE_YEAR_BASE_PENALTY:200}),r=e=>"number"==typeof e?Math.floor(e/a.MONTHLY_DOWNLOADS_INTERVAL)*a.MONTHLY_DOWNLOADS_POINTS:0,o=e=>"number"==typeof e?Math.floor(e/a.TOTAL_DOWNLOADS_INTERVAL)*a.TOTAL_DOWNLOADS_POINTS:0,s=e=>{const{contributors:t,forks:s,homebrew:i,npm:n,pypi:l,vscode:c,chocolatey:u,packagist:m,stars:p,commits:h,closedIssues:d,issues:g,repositoryDependents:f}=e;let y=0;if("number"==typeof p&&(y+=p*a.STAR_POINTS),"number"==typeof s&&(y+=s*a.FORK_POINTS),"number"==typeof t&&(y+=t*a.CONTRIBUTOR_POINTS),y+=r(n),y+=r(i),y+=r(l),y+=r(m),y+=o(c),y+=o(u),"number"==typeof d){const e=d*a.CLOSED_ISSUE_POINTS,t=Math.floor(.5*y);y+=Math.min(e,t)}if("number"==typeof f){const e=Math.floor(f/a.DIRECT_REPOSITORY_DEPENDENTS_INTERVAL)*a.DIRECT_REPOSITORY_DEPENDENTS_POINTS,t=Math.floor(.5*y);y+=Math.min(e,t)}if("string"==typeof h){const e=(e=>{const t=(new Date).getUTCFullYear(),r=e.match(/\b\d{4}\b/);if(!r)return 0;const o=t-parseInt(r[0],10);return o<a.MIN_INACTIVE_YEARS_FOR_PENALTY?0:o**2*a.INACTIVE_YEAR_BASE_PENALTY})(h);"number"==typeof g&&(y-=e>0?g*a.INACTIVE_ISSUE_PENALTY:g),y-=e}return y},i=e=>{if(e<1e3)return e.toLocaleString("pt-BR");const t=[{singular:" mil",plural:" mil"},{singular:" milhão",plural:" milhões"},{singular:" bilhão",plural:" bilhões"}];let a=Math.floor(Math.log10(e)/3);if(0===a)return e.toLocaleString("pt-BR");const r=(e/Math.pow(10,3*a)).toFixed(1).replace(".0","");return`${r}${Number(r)>=2?t[a-1].plural:t[a-1].singular}`},n=e=>{const t=Number(e.replace(/[^0-9.]/g,""))*(/k/i.test(e.replace(/mês/,""))?1e3:/m/i.test(e.replace(/mês/,""))?1e6:1);return{value:t,label:i(t)}},l={dm:{regex:/month/,replacement:"mês"},dy:{regex:/year/,replacement:"ano"},dt:void 0},c=e=>{const{registry:t,condition:a,period:r}={period:"dm",...e};return async e=>{if("function"==typeof a){const t=a(e);if(t instanceof Error)throw t}const o=await(await fetch(`https://img.shields.io/${t}/${r}/${e}.json?cacheSeconds=1`)).json(),s=l[r]?o.value.replace(l[r].regex,l[r].replacement):o.value;return n(s)}},u=c({registry:"chocolatey",period:"dt"}),m=async(e,t)=>{const a=await(await fetch(`https://img.shields.io/github/issues-closed/${e}/${t}.json?cacheSeconds=1`)).json();return n(a.value.replace(/closed/,""))},p={today:"Hoje",yesterday:"Ontem","this week":"Esta semana","this month":"Este mês","this year":"Este ano","last week":"Semana passada","last month":"Mês passado","last year":"Ano passado","two weeks ago":"Duas semanas atrás","three weeks ago":"Três semanas atrás","four weeks ago":"Quatro semanas atrás","five weeks ago":"Cinco semanas atrás","six weeks ago":"Seis semanas atrás","seven weeks ago":"Sete semanas atrás","eight weeks ago":"Oito semanas atrás","nine weeks ago":"Nove semanas atrás","ten weeks ago":"Dez semanas atrás","last sunday":"Último domingo","last monday":"Última segunda-feira","last tuesday":"Última terça-feira","last wednesday":"Última quarta-feira","last thursday":"Última quinta-feira","last friday":"Última sexta-feira","last saturday":"Último sábado",january:"Janeiro",february:"Fevereiro",march:"Março",april:"Abril",may:"Maio",june:"Junho",july:"Julho",august:"Agosto",september:"Setembro",october:"Outubro",november:"Novembro",december:"Dezembro"},h=async(e,t)=>{const a=(await(await fetch(`https://img.shields.io/github/last-commit/${e}/${t}.json?cacheSeconds=1`)).json()).value,r=new RegExp(Object.keys(p).join("|"),"gi");return a.replace(r,(e=>p[e.toLowerCase()]||e))},d=async(e,t)=>{const a=await(await fetch(`https://img.shields.io/github/contributors-anon/${e}/${t}.json?cacheSeconds=1`)).json();return n(a.value)},g=e=>{let{max:t}=e;if(!(Number.isInteger(t)&&t>0))throw new TypeError("`max` must be a positive integer");let a=0,r=0,o=0,s=[];const{onEviction:i}=e,n=new Map,l=new Array(t).fill(void 0),c=new Array(t).fill(void 0),u=new Array(t).fill(0),m=new Array(t).fill(0),p=(e,t)=>{if(e===o)return;const a=u[e],s=m[e];e===r?r=a:"get"!==t&&0===s||(u[s]=a),0!==a&&(m[a]=s),u[o]=e,m[e]=o,u[e]=0,o=e},h=()=>{const e=r,t=l[e];return null==i||i(t,c[e]),n.delete(t),l[e]=void 0,c[e]=void 0,r=u[e],0!==r&&(m[r]=0),a--,0===a&&(r=o=0),s.push(e),e};return{set(e,u){if(void 0===e)return;let m=n.get(e);void 0===m?(m=a===t?h():s.length>0?s.pop():a,n.set(e,m),l[m]=e,a++):null==i||i(e,c[m]),c[m]=u,1===a?r=o=m:p(m,"set")},get(e){const t=n.get(e);if(void 0!==t)return t!==o&&p(t,"get"),c[t]},peek:e=>{const t=n.get(e);return void 0!==t?c[t]:void 0},has:e=>n.has(e),*keys(){let e=o;for(let t=0;t<a;t++)yield l[e],e=m[e]},*values(){let e=o;for(let t=0;t<a;t++)yield c[e],e=m[e]},*entries(){let e=o;for(let t=0;t<a;t++)yield[l[e],c[e]],e=m[e]},forEach:e=>{let t=o;for(let r=0;r<a;r++){const a=l[t];e(c[t],a),t=m[t]}},delete(e){const t=n.get(e);if(void 0===t)return!1;null==i||i(e,c[t]),n.delete(e),s.push(t),l[t]=void 0,c[t]=void 0;const p=m[t],h=u[t];return 0!==p&&(u[p]=h),0!==h&&(m[h]=p),t===r&&(r=h),t===o&&(o=p),a--,!0},evict:e=>{let t=Math.min(e,a);for(;t>0;)h(),t--},clear(){if("function"==typeof i){const e=n.values();for(let t=e.next();!t.done;t=e.next())i(l[t.value],c[t.value])}n.clear(),l.fill(void 0),c.fill(void 0),s=[],a=0,r=o=0},resize:e=>{if(!(Number.isInteger(e)&&e>0))throw new TypeError("`max` must be a positive integer");if(e!==t){if(e<t){let t=o;const p=Math.min(a,e),h=a-p,d=new Array(e),g=new Array(e),f=new Array(e),y=new Array(e);for(let e=1;e<=h;e++)null==i||i(l[e],c[e]);for(let e=p-1;e>=0;e--)d[e]=l[t],g[e]=c[t],f[e]=e+1,y[e]=e-1,n.set(d[e],e),t=m[t];r=0,o=p-1,a=p,l.length=e,c.length=e,u.length=e,m.length=e;for(let e=0;e<p;e++)l[e]=d[e],c[e]=g[e],u[e]=f[e],m[e]=y[e];s=[];for(let t=p;t<e;t++)s.push(t)}else{const a=e-t;l.push(...new Array(a).fill(void 0)),c.push(...new Array(a).fill(void 0)),u.push(...new Array(a).fill(0)),m.push(...new Array(a).fill(0))}t=e}},get max(){return t},get size(){return a},get available(){return t-a}}},f={GitHub:g({max:1e3})},y=(()=>{try{return process?.env||Object.create(null)}catch(e){return Object.create(null)}})().GITHUB_TOKEN,w=async e=>{const t=f.GitHub.get(e);if(t)return t;const a={...y?{Authorization:`Bearer ${y}`}:Object.create(null),"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36"},r=await fetch(`https://api.github.com/${e}`,{headers:a});if(!r.ok)throw new Error("GitHub API error");const o=r.json();return f.GitHub.set(e,o),o},v=e=>new Promise((t=>setTimeout(t,e))),b=async(e,t)=>{let a,r=0;for(;r<10;){r++;const o=await(await fetch(`https://img.shields.io/github/forks/${e}/${t}.json?cacheSeconds=1`)).json();if("Unable to select next GitHub token from pool"!==o.value){a=n(o.value);break}if(r>=10)break;await v(1010)}if(!a)try{a=await(async(e,t)=>{const a=await w(`repos/${e}/${t}`),r=Number(a.forks_count);return{value:r,label:r.toLocaleString()}})(e,t)}catch{}return a||{value:0,label:"0"}},O=c({registry:"homebrew/installs"}),N=async(e,t)=>{const a=await(await fetch(`https://img.shields.io/github/issues/${e}/${t}.json?cacheSeconds=1`)).json();return n(a.value.replace(/open/,""))},S=async(e,t)=>{let a,r=0;for(;r<10;){r++;const o=await(await fetch(`https://img.shields.io/github/license/${e}/${t}.json?cacheSeconds=1`)).json();if("Unable to select next GitHub token from pool"!==o.value){a=o.value.includes("identifiable")?"Other":o.value;break}if(r>=10)break;await v(1010)}if(!a)try{a=await(async(e,t)=>{const a=await w(`repos/${e}/${t}`);return String(a?.license?.name||"Other")})(e,t)}catch{}return a||"Other"},T=c({registry:"npm"}),E=c({registry:"packagist",condition(e){const[t,a]=e.split("/");if(!t||0===t.trim().length||!a||0===a.trim().length)return new Error("Pacote Packagist inválido.",{cause:400})}}),A=c({registry:"pypi"}),I=async(e,t)=>{try{const a=await fetch(`https://github.com/${e}/${t}/network/dependents`),r=(await a.text()).split("\n");for(let e=0;e<r.length;e++){const t=r[e].trim();if(!/^[\d,]+$/.test(t))continue;if(!(e+1<r.length&&"Repositories"===r[e+1].trim()))continue;const a=Number(t.replace(/,/g,""))||0;return{value:a,label:i(a)}}return{value:0,label:"0"}}catch{return{value:0,label:"0"}}},_=async(e,t)=>{let a,r=0;for(;r<10;){r++;const o=await(await fetch(`https://img.shields.io/github/stars/${e}/${t}.json?cacheSeconds=1`)).json();if("Unable to select next GitHub token from pool"!==o.value){a=n(o.value);break}if(r>=10)break;await v(1010)}if(!a)try{a=await(async(e,t)=>{const a=await w(`repos/${e}/${t}`),r=Number(a.stargazers_count);return{value:r,label:r.toLocaleString()}})(e,t)}catch{}return a||{value:0,label:"0"}},k=async e=>{const t=await(await fetch(`https://img.shields.io/visual-studio-marketplace/i/${e}.json?cacheSeconds=1`)).json();if(t.value.includes("rate limited by upstream service")){const t=await(async()=>{try{const t=await fetch(`https://marketplace.visualstudio.com/items?itemName=${e}`),a=(await t.text()).split("\n");for(let e=0;e<a.length;e++){const t=a[e].trim();if(!t.includes("data-reactroot"))continue;const r=" installs",o=t.indexOf(r);if(-1===o)break;let s=o;for(;s>0&&(t[s-1]>="0"&&t[s-1]<="9"||","===t[s-1]);)s--;const i=t.substring(s,o).trim();return Number(i.replace(/,/g,""))||0}return 0}catch{return 0}})();return{value:t,label:i(t)}}return n(t.value)},L={stats:g({max:1e3}),rateLimit:g({max:1e3})},R=new Set(["https://awesomeyou.io","https://www.awesomeyou.io"]),P=10,$=6e4,D=6e4,j=e=>{const t=Date.now(),a=(e=>{const t=e.headers.get("CF-Connecting-IP")||e.headers.get("X-Forwarded-For")||"UNKNOWN";return String(t).slice(0,19)})(e),r=L.rateLimit.get(a);if(r?.blocked&&t<r.resetAt)return{available:!1,remaining:0,resetAt:r.resetAt};if(!r||t-r.timestamp>=$)return L.rateLimit.set(a,{count:1,timestamp:t,blocked:!1}),{available:!0,remaining:P-1};const o=r.count+1;if(o>P){const e=t+D;return L.rateLimit.set(a,{count:o,timestamp:r.timestamp,blocked:!0,resetAt:e}),{available:!1,remaining:0,resetAt:e}}return L.rateLimit.set(a,{...r,count:o}),{available:!0,remaining:P-o}},x={packageName:/[^a-z0-9-_.@\/]/gi},M=e=>void 0===e||"string"==typeof e&&(!(e.length>64)&&!x.packageName.test(e)),C=e=>{if("string"!=typeof e)return;const t=e.trim().replace(x.packageName,"");return t||void 0};var z={async fetch(e,a){if("POST"!==e.method)return new Response("Método não permitido.",{status:405});const r=j(e),o=e.headers.get("Origin"),i="production"===a.ENVIRONMENT;if(!o||"string"!=typeof o)return new Response("Método não permitido.",{status:405});if(i&&!R.has(o))return new Response("Acesso negado.",{status:403});const n=Object.freeze({"Access-Control-Allow-Origin":i?o:"*","Access-Control-Allow-Methods":"POST","Access-Control-Allow-Headers":"Content-Type","Content-Type":"application/json; charset=utf-8","X-RateLimit-Limit":String(P),"X-RateLimit-Remaining":String(r.remaining)}),l=(e,t=200)=>new Response(JSON.stringify(e),{status:t,headers:n});try{if(!r.available)return l({message:"Limite de requisições excedido. Tente novamente mais tarde."},429);const a=await e.text(),{repositoryURL:o,...i}=JSON.parse(a);if("string"!=typeof o)return l({message:"Repositório inválido."},400);if(!M(i.npm))return l({message:"Pacote npm inválido."},400);if(!M(i.homebrew))return l({message:"Pacote Homebrew inválido."},400);if(!M(i.pypi))return l({message:"Pacote PyPi inválido."},400);if(!M(i.chocolatey))return l({message:"Pacote Chocolatey inválido."},400);if(!M(i.vscode))return l({message:"ID do Visual Code Studio Marketplace inválido."},400);if(!M(i.packagist))return l({message:"Pacote Packagist inválido."},400);const n=o.trim(),c=C(i.npm),p=C(i.homebrew),g=C(i.pypi),f=C(i.chocolatey),y=C(i.vscode),w=C(i.packagist),{organization:v,repository:R}=t(n);let P=n;return"string"==typeof c&&(P+=`:${c}`),"string"==typeof p&&(P+=`:${p}`),"string"==typeof g&&(P+=`:${g}`),"string"==typeof f&&(P+=`:${f}`),"string"==typeof y&&(P+=`:${y}`),"string"==typeof w&&(P+=`:${w}`),L.stats.has(P)?l(L.stats.get(P)):l(await(async(e,a)=>{const{repository:r,npm:o,pypi:i,homebrew:n,vscode:l,chocolatey:c,packagist:p}=e,{organization:g,repository:f}=t(r),y=Object.create(null),w=await Promise.all([S(g,f),_(g,f),b(g,f),N(g,f),m(g,f),h(g,f),d(g,f),I(g,f)]);return y.license=w[0],y.stars=w[1],y.forks=w[2],y.issues=w[3],y.closedIssues=w[4],y.commits=w[5],y.contributors=w[6],y.repositoryDependents=w[7],o&&(y.npm=await T(o)),n&&(y.homebrew=await O(n)),i&&(y.pypi=await A(i)),l&&(y.vscode=await k(l)),c&&(y.chocolatey=await u(c)),p&&(y.packagist=await E(p)),y.score=s({contributors:y?.contributors?.value,forks:y?.forks?.value,homebrew:y?.homebrew?.value,npm:y?.npm?.value,pypi:y?.pypi?.value,vscode:y?.vscode?.value,chocolatey:y?.chocolatey?.value,packagist:y?.packagist?.value,stars:y?.stars?.value,issues:y?.issues?.value,closedIssues:y?.closedIssues?.value,commits:y?.commits,repositoryDependents:y.repositoryDependents?.value}),await a({organization:g,repository:f,results:y})})({description:"",repository:n,npm:c,homebrew:p,pypi:g,chocolatey:f,vscode:y,packagist:w},(({results:e})=>{const t=s({closedIssues:e?.closedIssues?.value,contributors:e?.contributors?.value,forks:e?.forks?.value,homebrew:e?.homebrew?.value,issues:e?.issues?.value,npm:e?.npm?.value,pypi:e?.pypi?.value,stars:e?.stars?.value,commits:e?.commits,chocolatey:e?.chocolatey?.value,repositoryDependents:e?.repositoryDependents?.value,vscode:e?.vscode?.value,packagist:e?.packagist?.value}),a={...e,score:t,username:v,repository:R};return L.stats.set(P,a),{...e,score:t,username:v,repository:R}})))}catch(e){return e instanceof Error&&400===e.cause?l({message:e.message},400):("production"!==a.ENVIRONMENT&&console.error(e),l({message:"Ops! Erro interno."},500))}}};export{z as default};
